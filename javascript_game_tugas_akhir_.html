<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tugas Akhir JavaScript Gamedev</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
            margin: 0;
            height: 100vh;
            background-image: linear-gradient(90deg, purple, blue);
        }

    </style>
</head>
<body>
<h1>Game Shooting JavaScript</h1>
<canvas id="GL_Canvas" width="1024" height="768" style="background-color: black;border:1px solid black;"></canvas>
<script type="text/javascript">
  //mengambil element canvas html dengan id GL_Canvas
  var canvas = document.getElementById("GL_Canvas")

  //mengambil context 2d dari element canvas
  var ctx = canvas.getContext("2d");
  var moveSpeed = 10;
  var velocity = 10;

  var triangle = {
    x: -100,
    y: 550,

    color: 'blue',

    draw: function () {
      ctx.beginPath();
      ctx.lineTo(200 + this.x, 100 + this.y);
      ctx.lineTo(170 + this.x, 150 + this.y);
      ctx.lineTo(230 + this.x, 150 + this.y);
      ctx.closePath();
      ctx.fillStyle = this.color;
      ctx.fill();
    }
  }

 //triangle.draw();

  //musuh berbentuk pentagon
  var pentagon = {
    x: 700,
    y: 0,

    color: 'purple',

    draw: function () {
      ctx.beginPath()
      ctx.lineTo(150 + this.x, 100 + this.y); //sudut ke-1
      ctx.lineTo(245 + this.x, 169 + this.y); //sudut ke-2
      ctx.lineTo(209 + this.x, 281 + this.y); //sudut ke-3
      ctx.lineTo(91 + this.x, 281 + this.y); //sudut ke-4
      ctx.lineTo(55 + this.x, 169 + this.y); //sudut ke-5
      ctx.closePath();
      ctx.fillStyle = this.color;
      ctx.fill();
    }
  }

  //tempat sprites
  var sprites = [];

  //membuat bullet
  class bullet {
      constructor() {
        this.x = triangle/2;
        this.y = triangle;
        this.radius = 5;
        this.color = 'red';
        this.alive = true;
        this.init = function () {
            this.x += 5;
            sprites.push(this);
        };
        this.renderBullet = function () {
            if (this.alive) {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, true);
                ctx.closePath();
                ctx.fillStyle = this.color;
                ctx.fill();
            }
        };
        this.updateBulletPos = function () {
            if (this.alive) {
                this.x += 7;
                if (this.x > pentagon) {
                    this.alive = false;
                    high_score++;
                }
            }
        };
      }
    }

  //buat bullet
  function createBullet() {
    bullets = new bullet();
    bullets.init();
  }

  //score awal
  var score = 0;

  //delay bullet
  const delay = 250; 
  var lastExecution = 0;

  //menambahkan event listener down
  window.addEventListener('keydown', (e) => {

    //menampilkan nama tombol keyboard di konsol yang baru saja ditekan
    console.log(`keydown | Tombol "${e.key}" ditahan`);
    ctx.clearRect(0, 0, canvas.width, canvas.height);
   // pentagon.draw();
   // high_score();

    //pengecekan apakah tombol yang baru saja ditekan adalah Tombol Arah Kanan
    if (e.key === 'ArrowRight') {
      triangle.x += moveSpeed
    }
    //pengecekan apakah tombol yang baru saja ditekan adalah Tombol Arah Kiri
    if (e.key === 'ArrowLeft') {
      triangle.x -= moveSpeed
    }
    //pengecekan apakah tombol yang baru saja ditekan adalah Tombol Arah Kiri
    if (e.key === 'Space') {
       if ((lastExecution + delay) < Date.now()){
            createBullet();
            lastExecution = Date.now() 
         }
    }
    //menggambarkan ulang lingkaran dengan nilai posisi x dan y baru
   // triangle.draw();
  });

  //highscore
  function high_score() {
  ctx.fillStyle = "white"
  ctx.font = '25px Comic Sans'
  ctx.fillText('  High Score: 0', + score, 60, 250)
  }
  
  //main game loop
  function loop() {
    updateBullet();
    render();
    requestAnimationFrame(loop);
  }

  function updateBullet() {
    for (var indexBullet = sprites.length; indexBullet--;) {
      sprites[indexBullet].updateBulletPos();
    }
  }

  function render() {
     ctx.clearRect(0, 0, canvas.width, canvas.height);

     triangle.draw();

     pentagon.draw();

     high_score();

     for (var indexBullet = sprites.length; indexBullet--;) {
          sprites[indexBullet].renderBullet();
      }
  }

  //mulai
  requestAnimationFrame(loop);

    high_score();
    pentagon.draw();
    triangle.draw();

</script>
</body>
</html>
